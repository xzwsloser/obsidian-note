## rpc 基本介绍
`rpc` 也就是 `remote process call` 也就是远程服务调用,可以让一台机器调用另外一台机器上运行的程序,通信的双方需要规定通信数据的格式,网络协议等,具体的 `RPC`通信过程示意图如下:
![[Pasted image 20250305171745.png]]

示意图中的调度过程如下:

1. 客户端与服务端之间会先约定统一的编码/数据格式，一般都是以服务端定义为主。
2. 客户端在本地代码中发起调度
3. client stub(客户端存根)：实际就是对rpc请求的封装包代码，主要事情是将接收到的调度请求，进行组装为对应的数据结构/编码/并将消息通过网络发送给目标服务器
4. server stub(服务端存根)：实际就是对rpc请求的封装包代码,主要是将接收到的消息按照定义好的编码拆包，获取请求方法与参数，并根据方法名和参数进行本地调用。
5. 服务端处理完请求，将结果通过server stub处理返回给调用的客户端。
6. 调用的客户端中基于client stub获取到请求后解析，最终得到本次rpc调用的结果

通信协议的选择: 一般采用 `TCP` 为主,而不是采用 `http`:
- 效率: `TCP` 面向连接,相对于 `HTTP` ，通信效率高,采用流式传输,保证了数据的完整性和可靠性
- 传输量: `RPC` 用于传递大量数据,`HTTP` 传递大量数据的时候采用了分块存储
- 灵活性: 可以支持各种通信协议,比如 `TCP/UDP/WebSocket`等
- 安全性: `TCP` 不用多少了吧,但是其实 `HTTPS`安全性也可以的

### 为什么使用 rpc 而不是使用 restful
`rpc` 和 `restful` 的区别如下:
- 定义区别：RPC是一种思想是对微服务之间的调度过程的定义，restful是一种http请求协议的标准规范
- 目标不同：RPC主要的调度对象本质对象是service；restful是基于http请求方法，调度的本质对象是controller
- 通信协议：rpc可以自定义协议，而restful是统一的http协议
- 传输协议：在rpc中传输的协议可以用二进制性能消耗低，而restful是json字符串
## net/rpc 实践
